var api = require('api');
var getContext = require('helpers/getContext');

var action = 'getBackgroundCheckStatus';
async function handler(req, res, next) {
	let credsContext = getContext("creds", req.body.result.contexts);

	let tilrRes = await api.get('/users/' + credsContext.parameters.id, {
		headers: {
			'X-API-EMAIL': credsContext.parameters.email,
			'X-API-TOKEN': credsContext.parameters.token
		}
	});
	req.log.info('status = %s', tilrRes.data.user.report_status);
	if (tilrRes.data.user.report_status === 'CompletedClear')
		res.send({ followupEvent: { name: 'BACKGROUND_COMPLETED_CLEAR' } });
	else
		res.send({ followupEvent: { name: 'BACKGROUND_INCOMPLETE' } });
}

module.exports = { action, handler };